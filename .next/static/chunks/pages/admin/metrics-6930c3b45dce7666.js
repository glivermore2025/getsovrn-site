(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[239],{1675:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>p});var a=t(7876),l=t(4232),r=t(7257),n=t(7432),i=t(9099),d=t(4007),c=t(3824),o=t(4069),h=t(570),u=t(7874),m=t(7362),x=t(4955);function p(){var e,s,t;let[p,b]=(0,l.useState)(null),[g,j]=(0,l.useState)({}),[N,v]=(0,l.useState)(""),[y,f]=(0,l.useState)(""),[_,w]=(0,l.useState)(1),T=(0,i.useRouter)(),D=(0,r.A)();(0,l.useEffect)(()=>{D.auth.getUser().then(e=>{let{data:s}=e,t=null==s?void 0:s.user;b(t),t&&n.j.includes(t.id)||T.push("/")}),k()},[]);let k=async()=>{let[{data:e},{data:s},{data:t}]=await Promise.all([D.from("listings").select("*"),D.from("transactions").select("*"),D.from("profiles").select("*")]),a=s||[];N&&(a=a.filter(e=>new Date(e.purchased_at)>=new Date(N))),y&&(a=a.filter(e=>new Date(e.purchased_at)<=new Date(y)));let l=a.reduce((e,s)=>e+(s.purchase_price||0),0),r={};a.forEach(e=>{let s=new Date(e.purchased_at).toISOString().split("T")[0];r[s]=(r[s]||0)+(e.purchase_price||0)});let n=Object.entries(r).map(e=>{let[s,t]=e;return{date:s,amount:t}}),i={};a.forEach(e=>{i[e.listing_id]=(i[e.listing_id]||0)+(e.purchase_price||0)});let d=Object.entries(i).map(e=>{let[s,t]=e;return{listing_id:s,revenue:t}}).sort((e,s)=>s.revenue-e.revenue).slice(0,5),c={};a.forEach(e=>{c[e.buyer_id]=(c[e.buyer_id]||0)+(e.purchase_price||0)});let o=Object.entries(c).map(e=>{let[s,t]=e;return{buyer_id:s,revenue:t}}).sort((e,s)=>s.revenue-e.revenue).slice(0,5);j({totalListings:(null==e?void 0:e.length)||0,totalRevenue:l.toFixed(2),totalUsers:(null==t?void 0:t.length)||0,chartData:n,recentTransactions:a,topListings:d,topSellers:o}),w(1)},S=g.recentTransactions?g.recentTransactions.slice((_-1)*10,10*_):[];return(0,a.jsxs)("div",{className:"text-white p-8 bg-gray-950 min-h-screen",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Metrics Dashboard"}),(0,a.jsxs)("div",{className:"bg-gray-800 p-4 rounded mb-8 flex gap-4 items-end",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"Start Date"}),(0,a.jsx)("input",{type:"date",value:N,onChange:e=>v(e.target.value),className:"bg-gray-900 p-2 rounded"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"End Date"}),(0,a.jsx)("input",{type:"date",value:y,onChange:e=>f(e.target.value),className:"bg-gray-900 p-2 rounded"})]}),(0,a.jsx)("button",{onClick:k,className:"bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded",children:"Apply Filters"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-10",children:[(0,a.jsxs)("div",{className:"bg-gray-800 p-6 rounded",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Total Listings"}),(0,a.jsx)("p",{className:"text-2xl",children:g.totalListings})]}),(0,a.jsxs)("div",{className:"bg-gray-800 p-6 rounded",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Total Users"}),(0,a.jsx)("p",{className:"text-2xl",children:g.totalUsers})]}),(0,a.jsxs)("div",{className:"bg-gray-800 p-6 rounded",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Total Revenue"}),(0,a.jsxs)("p",{className:"text-2xl",children:["$",g.totalRevenue]})]})]}),(0,a.jsxs)("div",{className:"bg-gray-800 p-6 rounded",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Revenue Over Time"}),(0,a.jsx)(d.u,{width:"100%",height:300,children:(0,a.jsxs)(c.b,{data:g.chartData,children:[(0,a.jsx)(o.d,{strokeDasharray:"3 3"}),(0,a.jsx)(h.W,{dataKey:"date"}),(0,a.jsx)(u.h,{}),(0,a.jsx)(m.m,{}),(0,a.jsx)(x.N,{type:"monotone",dataKey:"amount",stroke:"#38bdf8",strokeWidth:2})]})})]}),(0,a.jsxs)("div",{className:"bg-gray-800 p-6 rounded mt-10",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Top Selling Listings"}),(0,a.jsx)("ul",{children:null==(e=g.topListings)?void 0:e.map((e,s)=>(0,a.jsxs)("li",{className:"mb-2",children:[e.listing_id,": $",e.revenue.toFixed(2)]},s))})]}),(0,a.jsxs)("div",{className:"bg-gray-800 p-6 rounded mt-10",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Top Sellers"}),(0,a.jsx)("ul",{children:null==(s=g.topSellers)?void 0:s.map((e,s)=>(0,a.jsxs)("li",{className:"mb-2",children:[e.buyer_id,": $",e.revenue.toFixed(2)]},s))})]}),(0,a.jsxs)("div",{className:"bg-gray-800 p-6 rounded mt-10",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Recent Transactions"}),(0,a.jsxs)("table",{className:"w-full text-left",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,a.jsx)("th",{className:"p-2",children:"Buyer"}),(0,a.jsx)("th",{className:"p-2",children:"Listing"}),(0,a.jsx)("th",{className:"p-2",children:"Amount"}),(0,a.jsx)("th",{className:"p-2",children:"Date"})]})}),(0,a.jsx)("tbody",{children:S.map((e,s)=>{var t;return(0,a.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,a.jsx)("td",{className:"p-2",children:e.buyer_id}),(0,a.jsx)("td",{className:"p-2",children:e.listing_id}),(0,a.jsxs)("td",{className:"p-2",children:["$",null==(t=e.purchase_price)?void 0:t.toFixed(2)]}),(0,a.jsx)("td",{className:"p-2",children:new Date(e.purchased_at).toLocaleDateString()})]},s)})})]}),(null==(t=g.recentTransactions)?void 0:t.length)>10&&(0,a.jsxs)("div",{className:"mt-4 flex justify-between",children:[(0,a.jsx)("button",{disabled:1===_,onClick:()=>w(e=>e-1),className:"bg-gray-700 px-3 py-1 rounded disabled:opacity-50",children:"Previous"}),(0,a.jsxs)("span",{children:["Page ",_]}),(0,a.jsx)("button",{disabled:10*_>=g.recentTransactions.length,onClick:()=>w(e=>e+1),className:"bg-gray-700 px-3 py-1 rounded disabled:opacity-50",children:"Next"})]})]})]})}},2184:(e,s,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/metrics",function(){return t(1675)}])}},e=>{e.O(0,[902,636,593,792],()=>e(e.s=2184)),_N_E=e.O()}]);