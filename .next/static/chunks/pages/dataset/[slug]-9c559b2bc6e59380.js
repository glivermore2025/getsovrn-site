(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[448],{3308:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var i=a(7876),s=a(9099),r=a(7328),l=a.n(r),n=a(4232),o=a(1040),d=a(7257);function c(){var e;let{slug:t}=(0,s.useRouter)().query,a=(0,d.A)(),[r,c]=(0,n.useState)(null),[u,h]=(0,n.useState)(!0),[g,b]=(0,n.useState)(null),[f,p]=(0,n.useState)(!1),[_,m]=(0,n.useState)(!1),[x,y]=(0,n.useState)(!1),v=(0,n.useMemo)(()=>r?(r.unit_price_cents/100).toFixed(2):"0.00",[r]);(0,n.useEffect)(()=>{t&&(async()=>{h(!0),b(null);try{let{data:e,error:i}=await a.from("datasets").select("*").eq("slug",t).maybeSingle();if(i)throw i;c(e);let{data:s}=await a.auth.getUser();if(e&&(null==s?void 0:s.user)){let{data:t,error:i}=await a.from("dataset_contributions").select("id, is_active").eq("dataset_id",e.id).eq("user_id",s.user.id).maybeSingle();!i&&(null==t?void 0:t.is_active)?p(!0):p(!1)}else p(!1)}catch(e){console.error("Failed to load dataset:",e),b("Failed to load this dataset. Please try again.")}finally{h(!1)}})()},[t]);let w=async()=>{if(r){m(!0);try{let{data:{user:e}}=await a.auth.getUser();if(!e)return void alert("Please log in to manage your contribution.");if(f){let{error:t}=await a.from("dataset_contributions").update({is_active:!1}).eq("dataset_id",r.id).eq("user_id",e.id);if(t){console.error("Stop contribution failed:",t),alert("Could not stop contributing. Please try again.");return}p(!1)}else{let{error:t}=await a.from("dataset_contributions").upsert({dataset_id:r.id,user_id:e.id,is_active:!0,weight:1},{onConflict:"dataset_id,user_id"});if(t){console.error("Start contribution failed:",t),alert("Could not start contributing. Please try again.");return}p(!0)}}finally{m(!1)}}},N=async()=>{if(r){y(!0);try{var e;let{data:{user:t}}=await a.auth.getUser();if(!t)return void alert("Please log in to purchase access.");let i=await o.A.post("/api/checkout_sessions",{datasetId:r.id,userId:t.id}),s=null==i||null==(e=i.data)?void 0:e.url;if(!s){console.error("No checkout URL:",null==i?void 0:i.data),alert("Checkout could not be started. Please try again.");return}window.location.href=s}catch(e){console.error("Checkout error:",e),alert("Failed to initiate purchase.")}finally{y(!1)}}};return u?(0,i.jsx)("div",{className:"p-8 text-white",children:"Loading…"}):g||!r?(0,i.jsx)("div",{className:"p-8 text-red-400",children:g||"Dataset not found."}):(0,i.jsxs)("div",{className:"min-h-screen bg-gray-950 text-white p-8",children:[(0,i.jsx)(l(),{children:(0,i.jsxs)("title",{children:[r.name," – Sovrn"]})}),(0,i.jsx)("h1",{className:"text-3xl font-bold mb-2",children:r.name}),r.description&&(0,i.jsx)("p",{className:"text-gray-400 mb-4",children:r.description}),(null==(e=r.tags)?void 0:e.length)?(0,i.jsxs)("p",{className:"text-sm text-gray-500 mb-4",children:["Tags: ",r.tags.join(", ")]}):null,(0,i.jsxs)("p",{className:"text-xl font-semibold mb-6",children:["Unit Price: $",v]}),(0,i.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,i.jsx)("button",{onClick:w,disabled:_,className:"px-4 py-2 rounded ".concat(f?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700"," disabled:opacity-60"),children:_?"Saving…":f?"Stop Contributing":"Contribute Data"}),(0,i.jsx)("button",{onClick:N,disabled:x,className:"px-4 py-2 rounded bg-blue-600 hover:bg-blue-700 disabled:opacity-60",children:x?"Redirecting…":"Buy Access"})]})]})}},8380:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/dataset/[slug]",function(){return a(3308)}])}},e=>{e.O(0,[149,636,593,792],()=>e(e.s=8380)),_N_E=e.O()}]);