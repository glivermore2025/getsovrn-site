(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[329],{757:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/marketplace",function(){return s(5712)}])},5712:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>g});var r=s(7876),a=s(7328),l=s.n(a),i=s(8230),n=s.n(i),o=s(4232),d=s(7257),c=s(1040),u=s(9099);function g(){let e=(0,u.useRouter)(),[t,s]=(0,o.useState)("buy"),[a,i]=(0,o.useState)([]),[g,x]=(0,o.useState)([]),[p,h]=(0,o.useState)(""),[m,b]=(0,o.useState)("all"),[y,f]=(0,o.useState)("newest"),[j,w]=(0,o.useState)([]),[v,N]=(0,o.useState)(null),[_,C]=(0,o.useState)(null),k=(0,d.A)();(0,o.useEffect)(()=>{S(),E()},[]),(0,o.useEffect)(()=>{D()},[p,m,y,a]);let S=async()=>{let{data:e,error:t}=await k.from("listings").select("*").eq("is_flagged",!1).order("created_at",{ascending:!1});t||i(e||[])},E=async()=>{let{data:e,error:t}=await k.from("buyer_posts").select("*").order("created_at",{ascending:!1});t||x(e||[])},D=()=>{let e=[...a];p&&(e=e.filter(e=>e.title.toLowerCase().includes(p.toLowerCase())||e.description.toLowerCase().includes(p.toLowerCase()))),"all"!==m&&(e=e.filter(e=>{var t;return null==(t=e.tags)?void 0:t.includes(m)})),"price_low"===y?e.sort((e,t)=>e.price-t.price):"price_high"===y?e.sort((e,t)=>t.price-e.price):e.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()),w(e)},T=async e=>{N(e);try{let{data:{user:t}}=await k.auth.getUser();if(!t)return void alert("You must be logged in to purchase.");let s=await c.A.post("/api/checkout_sessions",{listingId:e,userId:t.id});window.location.href=s.data.url}catch(e){console.error("Checkout failed:",e),alert("Failed to initiate payment.")}finally{N(null)}},F=async t=>{C(t);try{let{data:{user:s}}=await k.auth.getUser();if(!s)return void alert("You must be logged in to opt in.");let{data:r}=await k.from("buyer_post_optins").select("id").eq("buyer_post_id",t).eq("user_id",s.id);if(r&&r.length>0)return void alert("You have already opted in to this request.");let{error:a}=await k.from("buyer_post_optins").insert([{buyer_post_id:t,user_id:s.id}]);a?(console.error("Error opting in:",a),alert("Failed to opt-in.")):e.push("/marketplace?refresh=true#sell")}catch(e){console.error("Error during opt-in:",e),alert("An error occurred while opting in.")}finally{C(null)}},L=Array.from(new Set(a.flatMap(e=>e.tags||[])));return(0,r.jsxs)("div",{className:"min-h-screen bg-gray-950 text-white p-6 md:p-10",children:[(0,r.jsx)(l(),{children:(0,r.jsx)("title",{children:"Marketplace â€“ Sovrn"})}),(0,r.jsx)("h1",{className:"text-4xl font-bold mb-8 text-center",children:"Data Marketplace"}),(0,r.jsxs)("div",{className:"flex justify-center mb-8 space-x-4",children:[(0,r.jsx)("button",{onClick:()=>s("buy"),className:"px-4 py-2 rounded ".concat("buy"===t?"bg-blue-600":"bg-gray-700 hover:bg-gray-600"),children:"Buy Data"}),(0,r.jsx)("button",{onClick:()=>s("sell"),className:"px-4 py-2 rounded ".concat("sell"===t?"bg-blue-600":"bg-gray-700 hover:bg-gray-600"),children:"Sell Data"})]}),"buy"===t&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex flex-wrap gap-4 justify-center mb-10",children:[(0,r.jsx)("input",{type:"text",value:p,onChange:e=>h(e.target.value),placeholder:"Search listings...",className:"px-4 py-2 rounded bg-gray-800 border border-gray-700 w-full sm:w-64"}),(0,r.jsxs)("select",{value:m,onChange:e=>b(e.target.value),className:"px-4 py-2 rounded bg-gray-800 border border-gray-700",children:[(0,r.jsx)("option",{value:"all",children:"All Tags"}),L.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]}),(0,r.jsxs)("select",{value:y,onChange:e=>f(e.target.value),className:"px-4 py-2 rounded bg-gray-800 border border-gray-700",children:[(0,r.jsx)("option",{value:"newest",children:"Newest"}),(0,r.jsx)("option",{value:"price_low",children:"Price: Low to High"}),(0,r.jsx)("option",{value:"price_high",children:"Price: High to Low"})]})]}),0===j.length?(0,r.jsx)("p",{className:"text-center text-gray-400 mt-20",children:"No listings found."}):(0,r.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8",children:j.map(e=>{var t;return(0,r.jsxs)("div",{className:"bg-gray-900 p-6 rounded-xl shadow hover:shadow-blue-700/30 transition",children:[(0,r.jsx)("h3",{className:"text-2xl font-semibold mb-2 text-white",children:e.title}),(0,r.jsx)("p",{className:"text-sm text-gray-400 mb-4 line-clamp-3",children:e.description}),(0,r.jsxs)("p",{className:"text-lg font-bold text-green-400 mb-2",children:["$",e.price.toFixed(2)]}),(null==(t=e.tags)?void 0:t.length)>0&&(0,r.jsxs)("p",{className:"text-sm text-gray-300 mb-4",children:["Tags:"," ",(0,r.jsx)("span",{className:"text-blue-400",children:e.tags.join(", ")})]}),(0,r.jsxs)("div",{className:"flex justify-center gap-2 mt-4",children:[(0,r.jsx)(n(),{href:"/listing/".concat(e.id),children:(0,r.jsx)("span",{className:"flex-1 text-center bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg text-sm font-medium cursor-pointer",children:"View Details"})}),(0,r.jsx)("button",{onClick:()=>T(e.id),disabled:v===e.id,className:"flex-1 text-center bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg text-sm font-medium",children:v===e.id?"Processing...":"Buy Data"})]})]},e.id)})})]}),"sell"===t&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"flex justify-center mb-8",children:(0,r.jsx)(n(),{href:"/buyer_posts/new",className:"bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg text-sm font-medium",children:"+ Create Buyer Post"})}),0===g.length?(0,r.jsx)("p",{className:"text-center text-gray-400 mt-20",children:"No buyer posts found."}):(0,r.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8",children:g.map(e=>{var t;return(0,r.jsxs)("div",{className:"bg-gray-900 p-6 rounded-xl shadow hover:shadow-blue-700/30 transition",children:[(0,r.jsx)("h3",{className:"text-2xl font-semibold mb-2 text-white",children:e.title}),(0,r.jsx)("p",{className:"text-sm text-gray-400 mb-4 line-clamp-3",children:e.description}),(0,r.jsxs)("p",{className:"text-lg font-bold text-green-400 mb-2",children:["Budget: $",e.budget.toFixed(2)]}),(null==(t=e.tags)?void 0:t.length)>0&&(0,r.jsxs)("p",{className:"text-sm text-gray-300 mb-4",children:["Tags:"," ",(0,r.jsx)("span",{className:"text-blue-400",children:e.tags.join(", ")})]}),(0,r.jsxs)("div",{className:"flex justify-center gap-2 mt-4",children:[(0,r.jsx)(n(),{href:"/buyer_posts/".concat(e.id),children:(0,r.jsx)("span",{className:"flex-1 text-center bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg text-sm font-medium cursor-pointer",children:"View Details"})}),(0,r.jsx)("button",{onClick:()=>F(e.id),disabled:_===e.id,className:"flex-1 text-center bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg text-sm font-medium",children:_===e.id?"Opting in...":"Opt-in"})]})]},e.id)})})]})]})}}},e=>{e.O(0,[149,636,593,792],()=>e(e.s=757)),_N_E=e.O()}]);