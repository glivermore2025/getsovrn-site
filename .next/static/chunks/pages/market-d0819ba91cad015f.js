(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[880],{228:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/market",function(){return a(312)}])},312:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>u});var s=a(7876),l=a(7328),r=a.n(l),n=a(8230),i=a.n(n),d=a(4232),c=a(1040),o=a(7257);function u(){let[e,t]=(0,d.useState)([]),[a,l]=(0,d.useState)(null),[n,u]=(0,d.useState)(!0),[x,m]=(0,d.useState)(null),[h,g]=(0,d.useState)({}),b=(0,o.A)();(0,d.useEffect)(()=>{(async()=>{u(!0),m(null);let{data:e,error:a}=await b.from("datasets").select("*").eq("is_active",!0).order("created_at",{ascending:!1});a?(console.error("Failed to load datasets:",a),m("Failed to load datasets. Please try again.")):t(e||[]),u(!1)})()},[]);let p=async e=>{try{var t,a;l(e),m(null);let{data:{user:s}}=await b.auth.getUser();if(!s)return void alert("Please log in first.");let r=null!=(a=h[e])?a:1,n=await c.A.post("/api/checkout_sessions",{datasetId:e,userId:s.id,quantity:r}),i=null==n||null==(t=n.data)?void 0:t.url;if(!i){console.error("No checkout URL returned:",null==n?void 0:n.data),alert("Checkout could not be started. Please try again.");return}window.location.href=i}catch(e){console.error("Checkout failed:",e),alert("Failed to initiate payment.")}finally{l(null)}};return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-950 text-white p-8",children:[(0,s.jsx)(r(),{children:(0,s.jsx)("title",{children:"Markets – Sovrn"})}),(0,s.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Markets"}),n&&(0,s.jsx)("p",{className:"text-gray-400",children:"Loading datasets…"}),x&&(0,s.jsx)("p",{className:"text-red-400 mb-4",children:x}),n||0!==e.length?(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:e.map(e=>{var t,l;return(0,s.jsxs)("div",{className:"bg-gray-900 p-6 rounded-xl",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold",children:e.name}),e.description&&(0,s.jsx)("p",{className:"text-sm text-gray-400 mb-2",children:e.description}),(null==(t=e.tags)?void 0:t.length)?(0,s.jsxs)("p",{className:"text-xs text-gray-400 mb-2",children:["Tags: ",e.tags.join(", ")]}):null,"number"==typeof e.contributors_count&&(0,s.jsxs)("p",{className:"text-xs text-gray-400 mb-2",children:["Contributors: ",e.contributors_count]}),(0,s.jsxs)("p",{className:"text-lg font-bold",children:["Price: $",(e.unit_price_cents/100).toFixed(2)]}),(0,s.jsxs)("div",{className:"mt-3 flex items-center gap-2",children:[(0,s.jsx)("label",{htmlFor:"qty-".concat(e.id),className:"text-sm text-gray-300",children:"Quantity"}),(0,s.jsx)("input",{id:"qty-".concat(e.id),type:"number",min:1,max:100,value:null!=(l=h[e.id])?l:1,onChange:t=>{var a,s;return a=e.id,s=Number(t.target.value),void g(e=>({...e,[a]:Math.max(1,Math.min(100,Math.floor(Number(s)||1)))}))},className:"w-20 bg-gray-800 rounded px-2 py-1 border border-gray-700"})]}),(0,s.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,s.jsx)(i(),{href:"/dataset/".concat(e.slug),className:"bg-blue-600 hover:bg-blue-700 px-3 py-2 rounded text-sm",children:"View"}),(0,s.jsx)("button",{onClick:()=>p(e.id),disabled:a===e.id,className:"bg-green-600 hover:bg-green-700 px-3 py-2 rounded text-sm disabled:opacity-60",children:a===e.id?"Processing…":"Buy Access"})]})]},e.id)})}):(0,s.jsx)("p",{children:"No datasets yet."})]})}}},e=>{e.O(0,[149,636,593,792],()=>e(e.s=228)),_N_E=e.O()}]);