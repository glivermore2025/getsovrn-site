(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[724],{4553:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>p});var a=t(7876),l=t(7328),r=t.n(l),i=t(4232),n=t(7257),d=t(7186),o=t(7085),c=t.n(o);let u=(0,n.A)(),m=async e=>{let{data:s,error:t}=await u.from("listings").select("*").eq("user_id",e).order("created_at",{ascending:!1});return t?(console.error("Error fetching listings:",t),[]):s||[]};var x=t(6870);function p(){let{user:e,loading:s}=(0,x.A)(),[t,l]=(0,i.useState)("seller"),[o,u]=(0,i.useState)(""),[p,h]=(0,i.useState)(""),[g,b]=(0,i.useState)(""),[y,j]=(0,i.useState)(""),[f,N]=(0,i.useState)(null),[_,v]=(0,i.useState)([]),[w,S]=(0,i.useState)([]),[k,C]=(0,i.useState)([]),[q,A]=(0,i.useState)(""),[F,E]=(0,i.useState)(null),[T,P]=(0,i.useState)(!1);(0,i.useEffect)(()=>{e&&(async()=>{v(await m(e.id))})()},[e]),(0,i.useEffect)(()=>{e&&(async()=>{let s=(0,n.A)(),{data:t,error:a}=await s.from("buyer_post_optins").select("\n          buyer_post_id,\n          buyer_posts ( title, description, budget, tags )\n        ").eq("user_id",e.id);!a&&t&&S(t.map(e=>({id:e.buyer_post_id,...e.buyer_posts})))})()},[e]),(0,i.useEffect)(()=>{e&&(async()=>{let s=(0,n.A)(),{data:t,error:a}=await s.from("buyer_posts").select("\n          id,\n          title,\n          description,\n          budget,\n          tags,\n          buyer_post_optins (\n            user_id,\n            profiles ( email )\n          )\n        ").eq("user_id",e.id);!a&&t&&C(t)})()},[e]);let D=async s=>{if(s.preventDefault(),!f||!e)return void A("Please upload a file and make sure you are logged in.");let t=f.name.split(".").pop(),a="".concat((0,d.A)(),".").concat(t),l=(0,n.A)(),{error:r}=await l.storage.from("datasets").upload(a,f,{contentType:f.type});if(r){console.error("Upload error:",r),A("File upload failed.");return}let{error:i}=await l.from("listings").insert([{user_id:e.id,title:o,description:p,price:parseFloat(g),tags:y.split(",").map(e=>e.trim()),file_path:a}]);if(i){console.error("Insert error:",i),A("Failed to save listing.");return}u(""),h(""),b(""),j(""),N(null),A(""),v(await m(e.id))},O=async e=>{var s;let t=(0,n.A)(),{data:a,error:l}=await t.storage.from("datasets").download(e);if(l||!a)return alert("Failed to load file.");let r=await a.text(),i=c().parse(r,{header:!0});E({file:e,rows:i.data.length,columns:(null==(s=i.meta.fields)?void 0:s.length)||0,headers:i.meta.fields||[]}),P(!0)},Y=async(s,t)=>{if(!confirm("Are you sure you want to delete this listing?"))return;let a=(0,n.A)(),{data:l}=await a.from("purchases").select("id").eq("listing_id",s);if(l&&l.length>0)return void alert("This listing cannot be deleted because purchases exist.");await a.storage.from("datasets").remove([t]),await a.from("listings").delete().eq("id",s).eq("user_id",e.id),v(await m(e.id))},B=async s=>{if(!confirm("Are you sure you want to opt out of this post?"))return;let t=(0,n.A)(),{error:a}=await t.from("buyer_post_optins").delete().eq("buyer_post_id",s).eq("user_id",e.id);if(a){console.error("Failed to opt out:",a),alert("Failed to opt out of this post.");return}let{data:l}=await t.from("buyer_post_optins").select("\n        buyer_post_id,\n        buyer_posts ( title, description, budget, tags )\n      ").eq("user_id",e.id);l&&S(l.map(e=>({id:e.buyer_post_id,...e.buyer_posts})))};return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-950 text-white p-8",children:[(0,a.jsx)(r(),{children:(0,a.jsx)("title",{children:"Dashboard â€“ Sovrn"})}),(0,a.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"User Dashboard"}),(0,a.jsxs)("div",{className:"flex mb-8 space-x-4",children:[(0,a.jsx)("button",{onClick:()=>l("seller"),className:"px-4 py-2 rounded ".concat("seller"===t?"bg-blue-600":"bg-gray-700 hover:bg-gray-600"),children:"Seller"}),(0,a.jsx)("button",{onClick:()=>l("buyer"),className:"px-4 py-2 rounded ".concat("buyer"===t?"bg-blue-600":"bg-gray-700 hover:bg-gray-600"),children:"Buyer"})]}),s?(0,a.jsx)("p",{children:"Loading..."}):e?"seller"===t?(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-10",children:[(0,a.jsxs)("form",{onSubmit:D,className:"space-y-4 bg-gray-900 p-6 rounded-md",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Create New Listing"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"Title"}),(0,a.jsx)("input",{type:"text",className:"w-full p-2 rounded bg-gray-800",value:o,onChange:e=>u(e.target.value),required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"Description"}),(0,a.jsx)("textarea",{className:"w-full p-2 rounded bg-gray-800",value:p,onChange:e=>h(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"Tags (comma-separated)"}),(0,a.jsx)("input",{type:"text",className:"w-full p-2 rounded bg-gray-800",value:y,onChange:e=>j(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"Price (USD)"}),(0,a.jsx)("input",{type:"number",className:"w-full p-2 rounded bg-gray-800",value:g,onChange:e=>b(e.target.value),required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm mb-1",children:"Upload File"}),(0,a.jsx)("input",{type:"file",className:"w-full p-2 rounded bg-gray-800",onChange:e=>{var s;return N((null==(s=e.target.files)?void 0:s[0])||null)},required:!0})]}),(0,a.jsx)("button",{type:"submit",className:"bg-blue-600 py-2 px-4 rounded w-full",children:"Submit Listing"}),q&&(0,a.jsx)("p",{className:"text-red-400 text-sm mt-2",children:q})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Your Listings"}),0===_.length?(0,a.jsx)("p",{children:"No listings yet."}):(0,a.jsx)("ul",{className:"space-y-4",children:_.map(e=>(0,a.jsxs)("li",{className:"bg-gray-800 p-4 rounded",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:e.title}),(0,a.jsx)("p",{className:"text-sm text-gray-400",children:e.description}),(0,a.jsxs)("p",{className:"text-sm text-gray-300",children:["$",e.price.toFixed(2)]}),(0,a.jsxs)("p",{className:"text-sm text-gray-400",children:["Tags: ",e.tags.join(", ")]}),(0,a.jsxs)("div",{className:"flex gap-4 mt-2",children:[(0,a.jsx)("button",{onClick:()=>O(e.file_path),className:"text-blue-400 underline text-sm",children:"Preview"}),(0,a.jsx)("button",{onClick:()=>Y(e.id,e.file_path),className:"text-red-400 underline text-sm",children:"Delete"})]})]},e.id))})]})]}):(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Posts You Have Opted Into"}),0===w.length?(0,a.jsx)("p",{children:"No buyer posts opted into yet."}):(0,a.jsx)("ul",{className:"space-y-4 mb-10",children:w.map(e=>{var s;return(0,a.jsxs)("li",{className:"bg-gray-800 p-4 rounded",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:e.title}),(0,a.jsx)("p",{className:"text-sm text-gray-400",children:e.description}),(0,a.jsxs)("p",{className:"text-sm text-gray-300",children:["Budget: $",e.budget.toFixed(2)]}),(0,a.jsxs)("p",{className:"text-sm text-gray-400",children:["Tags: ",null==(s=e.tags)?void 0:s.join(", ")]}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)("button",{onClick:()=>B(e.id),className:"bg-red-600 hover:bg-red-700 px-4 py-2 rounded text-sm",children:"Opt Out"})})]},e.id)})}),(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Your Buyer Posts & Opt-ins"}),0===k.length?(0,a.jsx)("p",{children:"You have not created any buyer posts yet."}):(0,a.jsx)("ul",{className:"space-y-6",children:k.map(e=>{var s;return(0,a.jsxs)("li",{className:"bg-gray-800 p-4 rounded",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",children:e.title}),(0,a.jsx)("p",{className:"text-sm text-gray-400",children:e.description}),(0,a.jsxs)("p",{className:"text-sm text-gray-300",children:["Budget: $",e.budget.toFixed(2)]}),(0,a.jsxs)("p",{className:"text-sm text-gray-400",children:["Tags: ",null==(s=e.tags)?void 0:s.join(", ")]}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("h4",{className:"font-semibold",children:"Sellers who opted in:"}),0===e.buyer_post_optins.length?(0,a.jsx)("p",{className:"text-gray-400 text-sm",children:"No sellers have opted in yet."}):(0,a.jsx)("ul",{className:"list-disc pl-6",children:e.buyer_post_optins.map(e=>{var s;return(0,a.jsx)("li",{className:"text-sm",children:(null==(s=e.profiles)?void 0:s.email)||e.user_id},e.user_id)})})]})]},e.id)})})]}):(0,a.jsx)("p",{className:"text-red-400",children:"You must be logged in to view the dashboard."}),T&&F&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-gray-900 p-6 rounded shadow-lg max-w-md w-full",children:[(0,a.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Data Preview"}),(0,a.jsxs)("p",{className:"text-sm mb-1",children:["File: ",F.file]}),(0,a.jsxs)("p",{className:"text-sm mb-1",children:["Columns: ",F.columns]}),(0,a.jsxs)("p",{className:"text-sm mb-1",children:["Rows: ",F.rows]}),(0,a.jsxs)("p",{className:"text-sm mb-2",children:["Headers: ",F.headers.join(", ")]}),(0,a.jsx)("button",{onClick:()=>P(!1),className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded mt-4",children:"Close"})]})})]})}},7580:(e,s,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return t(4553)}])}},e=>{e.O(0,[583,636,593,792],()=>e(e.s=7580)),_N_E=e.O()}]);