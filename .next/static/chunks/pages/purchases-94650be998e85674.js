(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[936],{2964:(e,s,i)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/purchases",function(){return i(3084)}])},3084:(e,s,i)=>{"use strict";i.r(s),i.d(s,{default:()=>c});var t=i(7876),l=i(4232),n=i(7328),r=i.n(n),a=i(7257);function c(){let[e,s]=(0,l.useState)([]),[i,n]=(0,l.useState)(!0),c=(0,a.A)();(0,l.useEffect)(()=>{(async()=>{let{data:{user:e},error:i}=await c.auth.getUser();if(i||!e){console.error("User not authenticated:",i),n(!1);return}console.log("Fetching purchases for user ID:",e.id);let{data:t,error:l}=await c.from("purchases").select("\n          listing_id,\n          listings (\n            title,\n            file_path,\n            price\n          )\n        ").eq("user_id",e.id);l?console.error("Error fetching purchases:",l):(console.log("Raw purchase data:",t),s((t||[]).map(e=>({listing_id:e.listing_id,listings:Array.isArray(e.listings)?e.listings[0]:e.listings})))),n(!1)})()},[]);let o=async e=>{let{data:s,error:i}=await c.storage.from("datasets").createSignedUrl(e,60);(null==s?void 0:s.signedUrl)?window.open(s.signedUrl,"_blank"):(alert("Failed to generate download link."),console.error(i))};return(0,t.jsxs)("div",{className:"min-h-screen bg-gray-950 text-white p-8",children:[(0,t.jsx)(r(),{children:(0,t.jsx)("title",{children:"My Purchases â€“ Sovrn"})}),(0,t.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"My Purchased Data"}),i?(0,t.jsx)("p",{children:"Loading purchases..."}):0===e.length?(0,t.jsx)("p",{children:"No purchases found."}):(0,t.jsx)("ul",{className:"space-y-4",children:e.map((e,s)=>{var i,l,n;return(0,t.jsxs)("li",{className:"bg-gray-800 p-4 rounded",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:(null==(i=e.listings)?void 0:i.title)||"Untitled"}),(null==(l=e.listings)?void 0:l.price)&&(0,t.jsxs)("p",{className:"text-sm text-gray-400 mb-2",children:["Price: $",e.listings.price.toFixed(2)]}),(null==(n=e.listings)?void 0:n.file_path)?(0,t.jsx)("button",{onClick:()=>o(e.listings.file_path),className:"text-blue-400 underline mt-2 inline-block",children:"Download File"}):(0,t.jsx)("p",{className:"text-sm text-red-400",children:"No file available"})]},s)})})]})}},7328:(e,s,i)=>{e.exports=i(9269)}},e=>{e.O(0,[636,593,792],()=>e(e.s=2964)),_N_E=e.O()}]);